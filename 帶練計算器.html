<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç·´åŠŸç¶“é©—è¨ˆç®—å™¨</title>
<style>
  body {
    font-family: system-ui, -apple-system, "Microsoft JhengHei", sans-serif;
    background: #f5f6f8;
    padding: 30px;
  }
  .box {
    max-width: 520px;
    background: #fff;
    padding: 20px 24px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,.08);
  }
  h2 { margin-top: 0; font-size: 20px; }
  label { display: block; margin-top: 14px; font-size: 14px; }
  input {
    width: 100%;
    padding: 8px 10px;
    margin-top: 4px;
    font-size: 15px;
  }
  button {
    margin-top: 18px;
    width: 100%;
    padding: 10px;
    font-size: 16px;
    background: #4a6cf7;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  pre {
    margin-top: 18px;
    background: #f0f2f5;
    padding: 12px;
    border-radius: 6px;
    font-size: 14px;
    white-space: pre-wrap;
  }
  details { margin-top: 14px; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 13px;
  }
  th, td {
    border-bottom: 1px solid #ddd;
    padding: 6px 4px;
    text-align: right;
  }
  th:first-child, td:first-child { text-align: left; }
  th { background: #f6f7f9; }
</style>
</head>

<body>
<div class="box">
  <h2>ç·´åŠŸç¶“é©—è¨ˆç®—å™¨ï¼ˆEXP å–®ä½ï¼šè¬ / å°æ™‚ï¼‰</h2>

  <label>æ‰“æ‰‹äººæ•¸</label>
  <input type="number" id="carryInput" value="1" min="1">

  <label>è¢«å¸¶è€…äººæ•¸</label>
  <input type="number" id="leecherInput" value="1" min="0">

  <label>å–®ä¸€æ‰“æ‰‹ EXPï¼ˆè¬ / å°æ™‚ï¼‰</label>
  <input type="number" id="expPerHourInput" value="120" min="0">

  <label>é¡å¤–ç¶“é©—åŠ æˆ (%)</label>
  <input type="number" id="bonusInput" value="0" min="0">

  <hr>

  <label>èµ·å§‹ç­‰ç´š (LV A)</label>
  <input type="number" id="lvStartInput" value="60" min="1" max="79">

  <label>ç›®å‰ EXP (%)</label>
  <input type="number" id="expPercentInput" value="0" min="0" max="99">

  <label>ç›®æ¨™ç­‰ç´š (LV B)</label>
  <input type="number" id="lvEndInput" value="70" min="2" max="80">

  <button onclick="calc()">è¨ˆç®—</button>

  <pre id="result">è«‹è¼¸å…¥æ•¸å€¼å¾ŒæŒ‰ã€Œè¨ˆç®—ã€</pre>

  <details>
    <summary>ğŸ“Š å±•é–‹æ¯ç´šæ˜ç´°ï¼ˆå«å®Œæˆæ™‚é–“ï¼‰</summary>
    <div id="detailTable"></div>
  </details>
</div>

<script>
// expNeed[lv] = LV lv â†’ lv+1 æ‰€éœ€ EXP
const expNeed = [
  null,
  2443, 2760, 3118, 3523, 3980, 4497, 5081, 5741,
  6487, 7330, 8282, 9358, 10574, 11948, 13501, 15256,
  17239, 19480, 22012, 24873, 28106, 31759, 35887, 40552,
  45823, 51779, 58510, 66116, 74711, 84423, 95397, 107798,
  121811, 137646, 155539, 175759, 198607, 224425, 253600,
  286568, 323821, 365917, 413486, 467239, 527980, 596617,
  674177, 761820, 860856, 1058852,
  2117366, 3112529, 4575417, 6725863, 9887019, 14533917,
  21364858, 31406342, 46167322, 52630747, 59999051,
  68398918, 77974766, 88891233, 101336006, 115523046,
  131696273, 150133750, 171152475, 193402296, 218544594,
  246955391, 279059591, 315337337, 356331190, 402654244,
  454999295, 514149203, 580988599
];

function formatTime(d) {
  return d.toLocaleString();
}

function calc() {
  const carryVal   = Number(document.getElementById("carryInput").value);
  const leecherVal = Number(document.getElementById("leecherInput").value);
  const expPH      = Number(document.getElementById("expPerHourInput").value) * 10000;
  const bonus      = Number(document.getElementById("bonusInput").value) / 100;
  const lvStart    = Number(document.getElementById("lvStartInput").value);
  const lvEnd      = Number(document.getElementById("lvEndInput").value);
  const expPct     = Number(document.getElementById("expPercentInput").value) / 100;

  if (carryVal <= 0 || carryVal + leecherVal <= 0) {
    result.textContent = "âŒ äººæ•¸è¨­å®šä¸æ­£ç¢º";
    return;
  }
  if (lvStart >= lvEnd) {
    result.textContent = "âŒ èµ·å§‹ç­‰ç´šå¿…é ˆå°æ–¼ç›®æ¨™ç­‰ç´š";
    return;
  }

  const leecherExpPH =
    (carryVal * expPH * (1 + bonus)) / (carryVal + leecherVal);

  let now = new Date();
  let currentTime = new Date(now);
  let totalHours = 0;
  let rows = "";

  for (let lv = lvStart; lv < lvEnd; lv++) {
    let needExp = expNeed[lv];
    if (lv === lvStart && expPct > 0) {
      needExp *= (1 - expPct);
    }

    const hours = needExp / leecherExpPH;
    totalHours += hours;
    currentTime = new Date(currentTime.getTime() + hours * 3600000);

    rows += `
      <tr>
        <td>LV ${lv} â†’ ${lv + 1}</td>
        <td>${(needExp / 10000).toFixed(2)}</td>
        <td>${hours.toFixed(2)}</td>
        <td>${formatTime(currentTime)}</td>
      </tr>
    `;
  }

  result.textContent =
`ç›®å‰æ™‚é–“ï¼š${formatTime(now)}

è¢«å¸¶è€… EXP / Hï¼š${(leecherExpPH / 10000).toFixed(2)} è¬

LV ${lvStart}ï¼ˆ${(expPct*100).toFixed(0)}%ï¼‰ â†’ LV ${lvEnd}
ç¸½ç·´åŠŸæ™‚é–“ï¼šç´„ ${totalHours.toFixed(2)} å°æ™‚
é è¨ˆå®Œæˆæ™‚é–“ï¼š${formatTime(currentTime)}`;

  document.getElementById("detailTable").innerHTML = `
    <table>
      <thead>
        <tr>
          <th>ç­‰ç´š</th>
          <th>å‰©é¤˜ EXPï¼ˆè¬ï¼‰</th>
          <th>å°æ™‚</th>
          <th>å®Œæˆæ™‚é–“</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}
</script>
</body>
</html>
