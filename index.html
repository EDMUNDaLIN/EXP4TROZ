<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç·´åŠŸç¶“é©—è¨ˆç®—å™¨</title>
<style>
  body {
    font-family: system-ui, -apple-system, "Microsoft JhengHei", sans-serif;
    background: #f5f6f8;
    padding: 30px;
  }
  .box {
    max-width: 520px;
    background: #fff;
    padding: 20px 24px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,.08);
  }
  h2 { margin-top: 0; font-size: 20px; }
  label { display: block; margin-top: 14px; font-size: 14px; }
  input {
    width: 100%;
    padding: 8px 10px;
    margin-top: 4px;
    font-size: 15px;
  }
  button {
    margin-top: 18px;
    width: 100%;
    padding: 10px;
    font-size: 16px;
    background: #4a6cf7;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  pre {
    margin-top: 18px;
    background: #f0f2f5;
    padding: 12px;
    border-radius: 6px;
    font-size: 14px;
    white-space: pre-wrap;
  }
  details { margin-top: 14px; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 13px;
  }
  th, td {
    border-bottom: 1px solid #ddd;
    padding: 6px 4px;
    text-align: right;
  }
  th:first-child, td:first-child { text-align: left; }
  th { background: #f6f7f9; }
</style>
</head>

<body>
<div class="box">
  <h2>ç·´åŠŸç¶“é©—è¨ˆç®—å™¨ï¼ˆEXP å–®ä½ï¼šè¬ / å°æ™‚ï¼‰</h2>

  <label>æ‰“æ‰‹äººæ•¸</label>
  <input type="number" id="carryInput" value="1" min="1">

  <label>è¢«å¸¶è€…äººæ•¸</label>
  <input type="number" id="leecherInput" value="1" min="0">

  <label>å–®ä¸€æ‰“æ‰‹ EXPï¼ˆè¬ / å°æ™‚ï¼‰</label>
  <input type="number" id="expPerHourInput" value="120" min="0">

  <label>é¡å¤–ç¶“é©—åŠ æˆ (%)</label>
  <input type="number" id="bonusInput" value="0" min="0">

  <hr>

  <label>èµ·å§‹ç­‰ç´š (LV A)</label>
  <input type="number" id="lvStartInput" value="60" min="1" max="79">

  <label>ç›®å‰ EXP (%)</label>
  <input type="number" id="expPercentInput" value="0" min="0" max="99">

  <label>ç›®æ¨™ç­‰ç´š (LV B)</label>
  <input type="number" id="lvEndInput" value="70" min="2" max="80">

  <button onclick="calc()">è¨ˆç®—</button>

  <pre id="result">è«‹è¼¸å…¥æ•¸å€¼å¾ŒæŒ‰ã€Œè¨ˆç®—ã€</pre>

  <details>
    <summary>ğŸ“Š å±•é–‹æ¯ç´šæ˜ç´°ï¼ˆå«å®Œæˆæ™‚é–“ï¼‰</summary>
    <div id="detailTable"></div>
  </details>
</div>

<script>
// expNeed[lv] = LV lv â†’ lv+1 æ‰€éœ€ EXP
const expNeed = [
  null, 2443,2736,3064,3431,3842,4303,4819,5397,
  6044,6769,7581,8490,9508,10648,11925,13356,14958,16752,18762,21013,23534,26358,29520,33062,37029,41472,46448,52021,58263,65254,73084,81854,91676,102677,114998,128797,144252,161562,180949,202662,226981,254218,284724,318890,357156,400014,448015,501776,561989,680006,1482156,2178770,3202791,4708104,6920913,10173741,14955400,21984439,32317125,36841522,41999335,47879242,54582336,62223863,70935204,80866132,92187391,105093625,119806732,135381607,152981215,172868773,195341713,220736135,249431833,281857970,318499506,359904442,406692019,455495061,510154468,571373004,639937764,716730295,802737930,899066481,1006954458,1127788992,1263123671];

function formatTime(d) {
  return d.toLocaleString();
}

function calc() {
  const carryVal   = Number(document.getElementById("carryInput").value);
  const leecherVal = Number(document.getElementById("leecherInput").value);
  const expPH      = Number(document.getElementById("expPerHourInput").value) * 10000;
  const bonus      = Number(document.getElementById("bonusInput").value) / 100;
  const lvStart    = Number(document.getElementById("lvStartInput").value);
  const lvEnd      = Number(document.getElementById("lvEndInput").value);
  const expPct     = Number(document.getElementById("expPercentInput").value) / 100;

  if (carryVal <= 0 || carryVal + leecherVal <= 0) {
    result.textContent = "âŒ äººæ•¸è¨­å®šä¸æ­£ç¢º";
    return;
  }
  if (lvStart >= lvEnd) {
    result.textContent = "âŒ èµ·å§‹ç­‰ç´šå¿…é ˆå°æ–¼ç›®æ¨™ç­‰ç´š";
    return;
  }

  const leecherExpPH =
    (carryVal * expPH * (1 + bonus)) / (carryVal + leecherVal);

  let now = new Date();
  let currentTime = new Date(now);
  let totalHours = 0;
  let rows = "";

  for (let lv = lvStart; lv < lvEnd; lv++) {
    let needExp = expNeed[lv];
    if (lv === lvStart && expPct > 0) {
      needExp *= (1 - expPct);
    }

    const hours = needExp / leecherExpPH;
    totalHours += hours;
    currentTime = new Date(currentTime.getTime() + hours * 3600000);

    rows += `
      <tr>
        <td>LV ${lv} â†’ ${lv + 1}</td>
        <td>${(needExp / 10000).toFixed(2)}</td>
        <td>${hours.toFixed(2)}</td>
        <td>${formatTime(currentTime)}</td>
      </tr>
    `;
  }

  result.textContent =
`ç›®å‰æ™‚é–“ï¼š${formatTime(now)}

è¢«å¸¶è€… EXP / Hï¼š${(leecherExpPH / 10000).toFixed(2)} è¬

LV ${lvStart}ï¼ˆ${(expPct*100).toFixed(0)}%ï¼‰ â†’ LV ${lvEnd}
ç¸½ç·´åŠŸæ™‚é–“ï¼šç´„ ${totalHours.toFixed(2)} å°æ™‚
é è¨ˆå®Œæˆæ™‚é–“ï¼š${formatTime(currentTime)}`;

  document.getElementById("detailTable").innerHTML = `
    <table>
      <thead>
        <tr>
          <th>ç­‰ç´š</th>
          <th>å‰©é¤˜ EXPï¼ˆè¬ï¼‰</th>
          <th>å°æ™‚</th>
          <th>å®Œæˆæ™‚é–“</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}
</script>
</body>
</html>
