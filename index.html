<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>ç·´åŠŸç¶“é©—é›™å‘è¨ˆç®—å™¨ v4.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, "Microsoft JhengHei", sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>

<body class="bg-slate-50 p-6">
    <div class="max-w-xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
        <div class="bg-slate-900 p-6 text-white">
            <h2 class="text-xl font-bold">ğŸš€ ç·´åŠŸæ¨¡æ“¬å™¨ v4.1</h2>
            <p class="text-slate-400 text-sm">æ”¯æ´ï¼šç­‰ç´šç›®æ¨™ / æ™‚é–“æ¨ç®—é›™å‘æ¨¡å¼</p>
        </div>

        <div class="p-6 space-y-6">
            <div class="grid grid-cols-2 gap-4 bg-slate-50 p-4 rounded-2xl">
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">æ‰“æ‰‹ / è¢«å¸¶äººæ•¸</label>
                    <div class="flex items-center gap-2 mt-1">
                        <input type="number" id="carryInput" value="1" class="w-full p-2 rounded-lg border">
                        <span class="text-slate-400">/</span>
                        <input type="number" id="leecherInput" value="1" class="w-full p-2 rounded-lg border">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">å–®æ‰“æ‰‹ EXP (è¬/H)</label>
                    <input type="number" id="expPerHourInput" value="120" class="w-full mt-1 p-2 rounded-lg border">
                </div>
                <div class="col-span-2">
                    <label class="text-xs font-bold text-slate-500 uppercase">é¡å¤–ç¶“é©—åŠ æˆ (%)</label>
                    <input type="number" id="bonusInput" value="0" class="w-full mt-1 p-2 rounded-lg border">
                </div>
            </div>

            <div class="space-y-3">
                <h3 class="font-bold text-slate-700 flex items-center gap-2 border-b pb-2">ğŸ“ ç›®å‰è§’è‰²é€²åº¦</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-slate-400">èµ·å§‹ç­‰ç´š (LV)</label>
                        <input type="number" id="lvStartInput" value="60" class="w-full p-2 rounded-lg border bg-blue-50">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">ç›®å‰ EXP (%)</label>
                        <input type="number" id="expPercentInput" value="0" class="w-full p-2 rounded-lg border bg-blue-50">
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="font-bold text-slate-700 border-b pb-2">ğŸ¯ é¸æ“‡è¨ˆç®—æ¨¡å¼</h3>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 border-2 border-blue-100 rounded-2xl hover:border-blue-500 transition">
                        <p class="text-xs font-bold text-blue-600 mb-2">æ¨¡å¼ Aï¼šæˆ‘æƒ³ç·´åˆ°...</p>
                        <label class="text-xs text-slate-400">ç›®æ¨™ç­‰ç´š (LV)</label>
                        <input type="number" id="lvEndInput" value="70" class="w-full p-2 rounded-lg border">
                        <button onclick="calcByLevel()" class="w-full mt-3 bg-blue-600 text-white py-2 rounded-xl text-sm font-bold shadow-md active:scale-95 transition">æ¨ç®—æ‰€éœ€æ™‚é–“</button>
                    </div>

                    <div class="p-4 border-2 border-green-100 rounded-2xl hover:border-green-500 transition">
                        <p class="text-xs font-bold text-green-600 mb-2">æ¨¡å¼ Bï¼šå¦‚æœæˆ‘ç·´...</p>
                        <label class="text-xs text-slate-400">è¨ˆç•«ç·´åŠŸæ™‚é–“ (H)</label>
                        <input type="number" id="hoursInput" value="24" class="w-full p-2 rounded-lg border">
                        <button onclick="calcByTime()" class="w-full mt-3 bg-green-600 text-white py-2 rounded-xl text-sm font-bold shadow-md active:scale-95 transition">æ¨ç®—ç›®æ¨™ç­‰ç´š</button>
                    </div>
                </div>
            </div>

            <div id="resultBox" class="hidden animate-fade-in">
                <pre id="result" class="bg-slate-900 text-green-400 p-4 rounded-2xl text-sm leading-relaxed overflow-x-auto"></pre>
                
                <details class="mt-4">
                    <summary class="text-sm font-bold text-slate-500 cursor-pointer hover:text-slate-800 transition">ğŸ“Š æŸ¥çœ‹å‡ç´šæ˜ç´°</summary>
                    <div id="detailTable" class="mt-2 overflow-x-auto custom-scrollbar max-h-60 border rounded-xl text-xs"></div>
                </details>
            </div>
        </div>
    </div>

<script>
const expNeed = [null,2443,2711,3009,3339,3706,4113,4565,5067,5624,6242,6928,7690,8535,9473,10515,11671,12954,14378,15959,17714,19662,21824,24224,26888,29845,33127,36770,40814,45303,50286,55817,61956,68771,76335,84731,94051,104396,115879,128625,142773,158478,175910,195260,216738,240579,267042,296416,329021,365213,434603,1037509,1525139,2241953,3295672,4844639,7121618,10468780,15389107,22621987,25789065,29399534,33515469,38207635,43556704,49654642,56606292,64531173,73565537,83864712,94767124,107086850,121008141,136739199,154515294,174602283,197300579,222949654,251933109,284684413,318846542,357108127,399961102,447956434,501711206,561916551,629346536,704868120,789452294,884186569,1061023882,1273228658,1527874389,1833449266,2200139119,2640166942,3168200330,3801840396,4562208475];

function getBaseData() {
    const carry = Number(document.getElementById("carryInput").value);
    const leecher = Number(document.getElementById("leecherInput").value);
    const expPH = Number(document.getElementById("expPerHourInput").value) * 10000;
    const bonus = Number(document.getElementById("bonusInput").value) / 100;
    const leecherExpPH = (carry * expPH * (1 + bonus)) / (carry + leecher);
    return {
        lvStart: Number(document.getElementById("lvStartInput").value),
        expPct: Number(document.getElementById("expPercentInput").value) / 100,
        leecherExpPH
    };
}

// æ¨¡å¼ Aï¼šç›®æ¨™ç­‰ç´šæ¨ç®—æ™‚é–“ (åŸé‚è¼¯å„ªåŒ–)
function calcByLevel() {
    const { lvStart, expPct, leecherExpPH } = getBaseData();
    const lvEnd = Number(document.getElementById("lvEndInput").value);
    
    if (lvStart >= lvEnd) return alert("ç›®æ¨™ç­‰ç´šå¿…é ˆå¤§æ–¼èµ·å§‹ç­‰ç´š");

    let totalHours = 0;
    let rows = "";
    let currentTime = new Date();

    for (let lv = lvStart; lv < lvEnd; lv++) {
        let needExp = expNeed[lv];
        if (lv === lvStart) needExp *= (1 - expPct);
        
        const h = needExp / leecherExpPH;
        totalHours += h;
        currentTime = new Date(currentTime.getTime() + h * 3600000);
        rows += `<tr><td class="p-2 border-b">LV ${lv}â†’${lv+1}</td><td class="p-2 border-b">${(needExp/10000).toFixed(2)}è¬</td><td class="p-2 border-b text-blue-600 font-bold">${h.toFixed(2)}h</td></tr>`;
    }

    showResult(`[æ¨¡å¼ Aï¼šç­‰ç´šç›®æ¨™]\né è¨ˆç¸½è€—æ™‚ï¼š${totalHours.toFixed(2)} å°æ™‚\nå®Œæˆæ—¥æœŸï¼š${currentTime.toLocaleString()}\næ¯å°æ™‚ç²å¾—ï¼š${(leecherExpPH/10000).toFixed(2)} è¬`, rows);
}

// æ¨¡å¼ Bï¼šæ™‚é–“æ¨ç®—ç­‰ç´š (æ–°åŠŸèƒ½)
function calcByTime() {
    const { lvStart, expPct, leecherExpPH } = getBaseData();
    const hours = Number(document.getElementById("hoursInput").value);
    
    if (hours <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç·´åŠŸæ™‚é–“");

    let totalExpGain = leecherExpPH * hours;
    let currentLv = lvStart;
    let currentExpPct = expPct;
    let rows = "";

    while (totalExpGain > 0 && currentLv < expNeed.length - 1) {
        let needExpToNext = expNeed[currentLv] * (1 - currentExpPct);
        
        if (totalExpGain >= needExpToNext) {
            // è¶³ä»¥å‡ç´š
            totalExpGain -= needExpToNext;
            rows += `<tr><td class="p-2 border-b text-green-600 font-bold">LV ${currentLv} ğŸš€ UP!</td><td class="p-2 border-b" colspan="2">å‡ç´šå®Œæˆ</td></tr>`;
            currentLv++;
            currentExpPct = 0;
        } else {
            // ç¶“é©—ç”¨å®Œï¼Œè¨ˆç®—æœ€çµ‚ % æ•¸
            currentExpPct += totalExpGain / expNeed[currentLv];
            totalExpGain = 0;
        }
    }

    showResult(`[æ¨¡å¼ Bï¼šæ™‚é–“æ¨ç®—]\nåœ¨ ${hours} å°æ™‚å¾Œ...\né è¨ˆç­‰ç´šï¼šLV ${currentLv}\né è¨ˆé€²åº¦ï¼š${(currentExpPct * 100).toFixed(2)} %\nç¸½ç²å¾— EXPï¼š${(leecherExpPH * hours / 10000).toFixed(2)} è¬`, rows);
}

function showResult(text, tableRows) {
    document.getElementById("resultBox").classList.remove("hidden");
    document.getElementById("result").textContent = text;
    document.getElementById("detailTable").innerHTML = `<table class="w-full text-left bg-white"><thead><tr class="bg-slate-100 text-[10px] uppercase font-bold text-slate-500"><th class="p-2">é€²åº¦</th><th class="p-2">ç¶“é©—</th><th class="p-2">è€—æ™‚</th></tr></thead><tbody>${tableRows}</tbody></table>`;
}
</script>
</body>

</html>
