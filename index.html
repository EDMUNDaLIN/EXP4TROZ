<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>ç·´åŠŸç¶“é©—é›™å‘è¨ˆç®—å™¨ v4.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, "Microsoft JhengHei", sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>

<body class="bg-slate-50 p-6">
    <div class="max-w-xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
        <div class="bg-slate-900 p-6 text-white">
            <h2 class="text-xl font-bold">ğŸš€ ç·´åŠŸæ¨¡æ“¬å™¨ v4.1</h2>
            <p class="text-slate-400 text-sm">æ”¯æ´ï¼šç­‰ç´šç›®æ¨™ / æ™‚é–“æ¨ç®—é›™å‘æ¨¡å¼</p>
        </div>

        <div class="p-6 space-y-6">
            <div class="grid grid-cols-2 gap-4 bg-slate-50 p-4 rounded-2xl">
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">æ‰“æ‰‹ / è¢«å¸¶äººæ•¸</label>
                    <div class="flex items-center gap-2 mt-1">
                        <input type="number" id="carryInput" value="1" class="w-full p-2 rounded-lg border">
                        <span class="text-slate-400">/</span>
                        <input type="number" id="leecherInput" value="1" class="w-full p-2 rounded-lg border">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">å–®æ‰“æ‰‹ EXP (è¬/H)</label>
                    <input type="number" id="expPerHourInput" value="120" class="w-full mt-1 p-2 rounded-lg border">
                </div>
                <div class="col-span-2">
                    <label class="text-xs font-bold text-slate-500 uppercase">é¡å¤–ç¶“é©—åŠ æˆ (%)</label>
                    <input type="number" id="bonusInput" value="0" class="w-full mt-1 p-2 rounded-lg border">
                </div>
            </div>

            <div class="space-y-3">
                <h3 class="font-bold text-slate-700 flex items-center gap-2 border-b pb-2">ğŸ“ ç›®å‰è§’è‰²é€²åº¦</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-slate-400">èµ·å§‹ç­‰ç´š (LV)</label>
                        <input type="number" id="lvStartInput" value="60" class="w-full p-2 rounded-lg border bg-blue-50">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">ç›®å‰ EXP (%)</label>
                        <input type="number" id="expPercentInput" value="0" class="w-full p-2 rounded-lg border bg-blue-50">
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="font-bold text-slate-700 border-b pb-2">ğŸ¯ é¸æ“‡è¨ˆç®—æ¨¡å¼</h3>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 border-2 border-blue-100 rounded-2xl hover:border-blue-500 transition">
                        <p class="text-xs font-bold text-blue-600 mb-2">æ¨¡å¼ Aï¼šæˆ‘æƒ³ç·´åˆ°...</p>
                        <label class="text-xs text-slate-400">ç›®æ¨™ç­‰ç´š (LV)</label>
                        <input type="number" id="lvEndInput" value="70" class="w-full p-2 rounded-lg border">
                        <button onclick="calcByLevel()" class="w-full mt-3 bg-blue-600 text-white py-2 rounded-xl text-sm font-bold shadow-md active:scale-95 transition">æ¨ç®—æ‰€éœ€æ™‚é–“</button>
                    </div>

                    <div class="p-4 border-2 border-green-100 rounded-2xl hover:border-green-500 transition">
                        <p class="text-xs font-bold text-green-600 mb-2">æ¨¡å¼ Bï¼šå¦‚æœæˆ‘ç·´...</p>
                        <label class="text-xs text-slate-400">è¨ˆç•«ç·´åŠŸæ™‚é–“ (H)</label>
                        <input type="number" id="hoursInput" value="24" class="w-full p-2 rounded-lg border">
                        <button onclick="calcByTime()" class="w-full mt-3 bg-green-600 text-white py-2 rounded-xl text-sm font-bold shadow-md active:scale-95 transition">æ¨ç®—ç›®æ¨™ç­‰ç´š</button>
                    </div>
                </div>
            </div>

            <div id="resultBox" class="hidden animate-fade-in">
                <pre id="result" class="bg-slate-900 text-green-400 p-4 rounded-2xl text-sm leading-relaxed overflow-x-auto"></pre>
                
                <details class="mt-4">
                    <summary class="text-sm font-bold text-slate-500 cursor-pointer hover:text-slate-800 transition">ğŸ“Š æŸ¥çœ‹å‡ç´šæ˜ç´°</summary>
                    <div id="detailTable" class="mt-2 overflow-x-auto custom-scrollbar max-h-60 border rounded-xl text-xs"></div>
                </details>
            </div>
        </div>
    </div>

<script>
const expNeed = [null, 2443,2736,3064,3431,3842,4303,4819,5397,6044,6769,7581,8490,9508,10648,11925,13356,14958,16752,18762,21013,23534,26358,29520,33062,37029,41472,46448,52021,58263,65254,73084,81854,91676,102677,114998,128797,144252,161562,180949,202662,226981,254218,284724,318890,357156,400014,448015,501776,561989,680006,1482156,2178770,3202791,4708104,6920913,10173741,14955400,21984439,32317125,36841522,41999335,47879242,54582336,62223863,70935204,80866132,92187391,105093625,119806732,135381607,152981215,172868773,195341713,220736135,249431833,281857970,318499506,359904442,406692019,455495061,510154468,571373004,639937764,716730295,802737930,899066481,1006954458,1127788992,1263123671];

function getBaseData() {
    const carry = Number(document.getElementById("carryInput").value);
    const leecher = Number(document.getElementById("leecherInput").value);
    const expPH = Number(document.getElementById("expPerHourInput").value) * 10000;
    const bonus = Number(document.getElementById("bonusInput").value) / 100;
    const leecherExpPH = (carry * expPH * (1 + bonus)) / (carry + leecher);
    return {
        lvStart: Number(document.getElementById("lvStartInput").value),
        expPct: Number(document.getElementById("expPercentInput").value) / 100,
        leecherExpPH
    };
}

// æ¨¡å¼ Aï¼šç›®æ¨™ç­‰ç´šæ¨ç®—æ™‚é–“ (åŸé‚è¼¯å„ªåŒ–)
function calcByLevel() {
    const { lvStart, expPct, leecherExpPH } = getBaseData();
    const lvEnd = Number(document.getElementById("lvEndInput").value);
    
    if (lvStart >= lvEnd) return alert("ç›®æ¨™ç­‰ç´šå¿…é ˆå¤§æ–¼èµ·å§‹ç­‰ç´š");

    let totalHours = 0;
    let rows = "";
    let currentTime = new Date();

    for (let lv = lvStart; lv < lvEnd; lv++) {
        let needExp = expNeed[lv];
        if (lv === lvStart) needExp *= (1 - expPct);
        
        const h = needExp / leecherExpPH;
        totalHours += h;
        currentTime = new Date(currentTime.getTime() + h * 3600000);
        rows += `<tr><td class="p-2 border-b">LV ${lv}â†’${lv+1}</td><td class="p-2 border-b">${(needExp/10000).toFixed(2)}è¬</td><td class="p-2 border-b text-blue-600 font-bold">${h.toFixed(2)}h</td></tr>`;
    }

    showResult(`[æ¨¡å¼ Aï¼šç­‰ç´šç›®æ¨™]\né è¨ˆç¸½è€—æ™‚ï¼š${totalHours.toFixed(2)} å°æ™‚\nå®Œæˆæ—¥æœŸï¼š${currentTime.toLocaleString()}\næ¯å°æ™‚ç²å¾—ï¼š${(leecherExpPH/10000).toFixed(2)} è¬`, rows);
}

// æ¨¡å¼ Bï¼šæ™‚é–“æ¨ç®—ç­‰ç´š (æ–°åŠŸèƒ½)
function calcByTime() {
    const { lvStart, expPct, leecherExpPH } = getBaseData();
    const hours = Number(document.getElementById("hoursInput").value);
    
    if (hours <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç·´åŠŸæ™‚é–“");

    let totalExpGain = leecherExpPH * hours;
    let currentLv = lvStart;
    let currentExpPct = expPct;
    let rows = "";

    while (totalExpGain > 0 && currentLv < expNeed.length - 1) {
        let needExpToNext = expNeed[currentLv] * (1 - currentExpPct);
        
        if (totalExpGain >= needExpToNext) {
            // è¶³ä»¥å‡ç´š
            totalExpGain -= needExpToNext;
            rows += `<tr><td class="p-2 border-b text-green-600 font-bold">LV ${currentLv} ğŸš€ UP!</td><td class="p-2 border-b" colspan="2">å‡ç´šå®Œæˆ</td></tr>`;
            currentLv++;
            currentExpPct = 0;
        } else {
            // ç¶“é©—ç”¨å®Œï¼Œè¨ˆç®—æœ€çµ‚ % æ•¸
            currentExpPct += totalExpGain / expNeed[currentLv];
            totalExpGain = 0;
        }
    }

    showResult(`[æ¨¡å¼ Bï¼šæ™‚é–“æ¨ç®—]\nåœ¨ ${hours} å°æ™‚å¾Œ...\né è¨ˆç­‰ç´šï¼šLV ${currentLv}\né è¨ˆé€²åº¦ï¼š${(currentExpPct * 100).toFixed(2)} %\nç¸½ç²å¾— EXPï¼š${(leecherExpPH * hours / 10000).toFixed(2)} è¬`, rows);
}

function showResult(text, tableRows) {
    document.getElementById("resultBox").classList.remove("hidden");
    document.getElementById("result").textContent = text;
    document.getElementById("detailTable").innerHTML = `<table class="w-full text-left bg-white"><thead><tr class="bg-slate-100 text-[10px] uppercase font-bold text-slate-500"><th class="p-2">é€²åº¦</th><th class="p-2">ç¶“é©—</th><th class="p-2">è€—æ™‚</th></tr></thead><tbody>${tableRows}</tbody></table>`;
}
</script>
</body>
</html>